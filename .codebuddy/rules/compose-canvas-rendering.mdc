---
description: 
alwaysApply: true
enabled: true
updatedAt: 2026-02-24T07:39:24.310Z
provider: 
---

# Compose Multiplatform Canvas LaTeX ç»˜åˆ¶è§„èŒƒ

> æœ¬è§„èŒƒçš„ç›®æ ‡ï¼š**è·¨å¹³å°æ¸²æŸ“ä¸€è‡´æ€§** + **æ•°å­¦æ’ç‰ˆç¾è§‚** + **å·¥ç¨‹å¯ç»´æŠ¤æ€§**ã€‚
> é€‚ç”¨äºåŸºäº Compose Multiplatform `Canvas` + `DrawScope` çš„è‡ªå®šä¹‰ LaTeX æ¸²æŸ“å¼•æ“ã€‚

---

## 1. æ¶æ„ï¼šMeasure/Draw ä¸¤é˜¶æ®µæ¨¡å‹

### 1.1 ä¸ºä»€ä¹ˆæ˜¯ä¸¤é˜¶æ®µè€Œéä¸‰é˜¶æ®µ

ä¼ ç»Ÿ UI æ¡†æ¶é‡‡ç”¨ Measure â†’ Layout â†’ Draw ä¸‰é˜¶æ®µã€‚ä½† LaTeX æ¸²æŸ“çš„ç‰¹æ®Šæ€§åœ¨äºï¼š**å¸ƒå±€å³æµ‹é‡** â€” ä¸€ä¸ªåˆ†æ•°çš„å¸ƒå±€ä½ç½®å®Œå…¨ç”±åˆ†å­/åˆ†æ¯çš„æµ‹é‡ç»“æœå†³å®šï¼Œä¸å­˜åœ¨ç‹¬ç«‹çš„"å¸ƒå±€çº¦æŸåå•†"é˜¶æ®µã€‚å› æ­¤é‡‡ç”¨æ›´åŠ¡å®çš„ä¸¤é˜¶æ®µæ¨¡å‹ï¼š

| é˜¶æ®µ | èŒè´£ | äº§å‡º |
|------|------|------|
| **Measureï¼ˆæµ‹é‡+å¸ƒå±€ï¼‰** | é€’å½’æµ‹é‡ ASTï¼Œè®¡ç®—æ¯ä¸ªèŠ‚ç‚¹çš„å°ºå¯¸ã€åŸºçº¿ã€å†…éƒ¨å­èŠ‚ç‚¹ç›¸å¯¹ä½ç½®ï¼Œå¹¶ç”Ÿæˆç»˜åˆ¶æŒ‡ä»¤ | `NodeLayout` |
| **Drawï¼ˆç»˜åˆ¶ï¼‰** | å°† `NodeLayout` çš„ç»˜åˆ¶æŒ‡ä»¤åœ¨ç»™å®šç»å¯¹åæ ‡ä¸‹æ‰§è¡Œ | å±å¹•åƒç´  |

### 1.2 NodeLayout æ ¸å¿ƒæ•°æ®ç»“æ„

```kotlin
class NodeLayout(
    val width: Float,
    val height: Float,
    val baseline: Float,
    val draw: DrawScope.(x: Float, y: Float) -> Unit
)
```

**è®¾è®¡å†³ç­–ä¸æ³¨æ„äº‹é¡¹**ï¼š

- **ä½¿ç”¨ `class` è€Œé `data class`**ï¼š`draw` æ˜¯ lambdaï¼Œä¸å‚ä¸ `equals`/`hashCode`ã€‚å¦‚æœä½¿ç”¨ `data class`ï¼Œ`remember(layout)` ç­‰åŸºäº equality çš„ç¼“å­˜æœºåˆ¶ä¼šäº§ç”Ÿè¯¯åˆ¤ã€‚éœ€è¦é€šè¿‡ `remember` çš„ key æ˜¯äº§ç”Ÿ layout çš„è¾“å…¥ï¼ˆå¦‚ AST èŠ‚ç‚¹ + é…ç½®ï¼‰ï¼Œè€Œé layout æœ¬èº«ã€‚
- `(x, y)` æ˜¯å…ƒç´ **å·¦ä¸Šè§’**çš„ç»å¯¹ç”»å¸ƒåæ ‡ï¼Œç”±çˆ¶çº§ä¼ å…¥ã€‚
- `baseline` æ˜¯ä»é¡¶éƒ¨åˆ°åŸºçº¿çš„è·ç¦»ï¼Œå§‹ç»ˆ >= 0ã€‚

### 1.3 draw lambda ä¸­çš„åæ ‡çº¦å®š

æ‰€æœ‰å­å…ƒç´ åœ¨ draw lambda å†…çš„ç»˜åˆ¶åæ ‡å¿…é¡»æ˜¯ **`(x + relativeX, y + relativeY)`** å½¢å¼ï¼Œå…¶ä¸­ `relativeX/relativeY` æ˜¯ Measure é˜¶æ®µé¢„è®¡ç®—çš„ç›¸å¯¹åç§»ï¼š

```kotlin
// âœ… æ­£ç¡®ï¼šMeasure é˜¶æ®µè®¡ç®—ç›¸å¯¹åç§»ï¼ŒDraw é˜¶æ®µä»…åšåŠ æ³•
fun measureFraction(...): NodeLayout {
    val numLayout = measureGroup(numerator, ...)
    val denLayout = measureGroup(denominator, ...)
    // Measure é˜¶æ®µè®¡ç®—å¥½æ‰€æœ‰ç›¸å¯¹ä½ç½®
    val numRelX = (totalWidth - numLayout.width) / 2f
    val numRelY = 0f
    val lineRelY = numLayout.height + numGap
    val denRelX = (totalWidth - denLayout.width) / 2f
    val denRelY = lineRelY + lineThickness + denGap

    return NodeLayout(
        width = totalWidth,
        height = totalHeight,
        baseline = lineRelY + axisHeight,
        draw = { x, y ->
            numLayout.draw(this, x + numRelX, y + numRelY)
            drawLine(...)  // åˆ†æ•°çº¿
            denLayout.draw(this, x + denRelX, y + denRelY)
        }
    )
}
```

**ç¦æ­¢åœ¨ draw lambda ä¸­åšçš„äº‹æƒ…**ï¼š
- âŒ è°ƒç”¨ `TextMeasurer.measure()`ï¼ˆæµ‹é‡å¿…é¡»æå‰å®Œæˆï¼‰
- âŒ è¿›è¡Œ `if/when` å¹³å°åˆ¤æ–­ï¼ˆå¹³å°å·®å¼‚å¿…é¡»åœ¨ Measure é˜¶æ®µè§£å†³ï¼‰
- âŒ åˆ†é…é›†åˆï¼ˆ`listOf`, `mutableListOf` ç­‰ï¼‰
- âŒ å­—ç¬¦ä¸²æ“ä½œï¼ˆæ‹¼æ¥ã€æ ¼å¼åŒ–ã€`AnnotatedString` æ„å»ºï¼‰

**å…è®¸åœ¨ draw lambda ä¸­åšçš„äº‹æƒ…**ï¼š
- âœ… è°ƒç”¨å­ layout çš„ `draw()`
- âœ… `drawText(precomputedTextLayoutResult, ...)`
- âœ… `drawLine()` / `drawRect()` / `drawPath(precomputedPath, ...)`
- âœ… `withTransform { scale/rotate }` + ç»˜åˆ¶è°ƒç”¨
- âœ… ç®€å•çš„ç®—æœ¯ï¼ˆ`x + offset` ç­‰ï¼‰

---

## 2. è¾¹ç•Œå®‰å…¨ï¼šæœç»å†…å®¹æˆªæ–­

> **æ ¸å¿ƒç›®æ ‡**ï¼šå†…å®¹åŒºç›¸å¯¹çˆ¶å®¹å™¨æœ‰åˆç†å†…è¾¹è·ï¼›å†…å®¹åŒºå†…éƒ¨å…ƒç´ å°½å¯èƒ½ç´§è´´ï¼Œä¸æµªè´¹ç©ºé—´ã€‚
> **é“å¾‹**ï¼š`NodeLayout` çš„ `(width, height)` å¿…é¡»å®Œæ•´åŒ…å«è¯¥èŠ‚ç‚¹æ‰€æœ‰å¯èƒ½äº§ç”Ÿåƒç´ çš„åŒºåŸŸï¼ˆå¢¨æ°´è¾¹ç•Œï¼‰ï¼Œç»ä¸å…è®¸ä»»ä½•åƒç´ ç»˜åˆ¶åˆ° `[0, width] Ã— [0, height]` ä¹‹å¤–ã€‚

### 2.1 ä¸¤ç§è¾¹ç•Œçš„åŒºåˆ†

| æ¦‚å¿µ | å®šä¹‰ | ä¸¾ä¾‹ |
|------|------|------|
| **é€»è¾‘è¾¹ç•Œ (Logical Box)** | TextMeasurer è¿”å›çš„ `size`ï¼Œå³æ–‡æœ¬çš„è¡Œæ¡†å¤§å° | `TextLayoutResult.size.width/height` |
| **å¢¨æ°´è¾¹ç•Œ (Ink Bounds)** | å­—å½¢å®é™…ç»˜åˆ¶çš„åƒç´ èŒƒå›´ï¼Œå¯èƒ½è¶…å‡ºé€»è¾‘è¾¹ç•Œ | æ–œä½“ "f" å³ä¾§æ‚¬ä¼¸ã€"g" ä¸‹æ–¹çš„ descender å°¾å·´ã€å¤§æ‹¬å·é¡¶åº•ç«¯ |

**è§„åˆ™**ï¼š`NodeLayout.width/height` å¿…é¡»åŸºäº**å¢¨æ°´è¾¹ç•Œ**ï¼Œè€Œéé€»è¾‘è¾¹ç•Œã€‚

### 2.2 æ°´å¹³æ–¹å‘æº¢å‡ºçš„æ¥æºä¸è¡¥å¿

#### (a) æ–œä½“æ‚¬ä¼¸ (Italic Overhang)

æ–œä½“å­—çš„æœ€åä¸€ä¸ªå­—ç¬¦å‘å³å€¾æ–œï¼Œå…¶å¢¨æ°´å¯èƒ½è¶…å‡ºé€»è¾‘å®½åº¦ï¼›ç¬¬ä¸€ä¸ªå­—ç¬¦å¯èƒ½å‘å·¦çªå‡º x=0ã€‚

```kotlin
// âš ï¸ å…³é”®ï¼šè¡¥å¿å€¼å¿…é¡»ä½¿ç”¨ px å•ä½ï¼Œä¸èƒ½ç”¨ sp çš„æ•°å€¼ç›´æ¥åŠ åˆ° px å®½åº¦ä¸Š
val fontSizePx = with(density) { context.fontSize.toPx() }

val rightOverhang = if (context.fontStyle == FontStyle.Italic && text.isNotEmpty()) {
    when {
        text.last().isUpperCase() -> fontSizePx * 0.15f
        text.last().isLowerCase() -> fontSizePx * 0.12f
        else -> fontSizePx * 0.08f
    }
} else 0f

val leftOverhang = if (context.fontStyle == FontStyle.Italic && text.isNotEmpty()) {
    when {
        text.first() in "FTVWYfv" -> fontSizePx * 0.05f  // å‘å·¦çªå‡ºå­—ç¬¦
        else -> 0f
    }
} else 0f

// width å¿…é¡»åŒ…å«ä¸¤ä¾§æ‚¬ä¼¸
val totalWidth = logicalWidth + leftOverhang + rightOverhang

// draw æ—¶å‘å³åç§» leftOverhangï¼Œç¡®ä¿å¢¨æ°´ä¸è¶…å‡º x=0
draw = { x, y -> drawText(result, topLeft = Offset(x + leftOverhang, y)) }
```

**ä¸¥ç¦å°† `TextUnit.value`ï¼ˆsp æ•°å€¼ï¼‰ç›´æ¥åŠ åˆ°åƒç´ å€¼ä¸Š**ã€‚åœ¨ 2x/3x å¯†åº¦å±å¹•ä¸Šï¼Œè¿™ä¼šå¯¼è‡´è¡¥å¿ä¸¥é‡ä¸è¶³ã€‚

#### (b) Stroke åŠå®½æº¢å‡º

ä½¿ç”¨ `Stroke(width = W)` ç»˜åˆ¶ Path æˆ– Line æ—¶ï¼Œç¬”ç”»ä¼šå‘è·¯å¾„ä¸¤ä¾§å„æ‰©å±• `W/2`ï¼š

```kotlin
// æ ¹å· V å½¢é’©å­ â€” å®½åº¦å¿…é¡»åŒ…å« Stroke åŠå®½
val strokeHalf = strokeWidth / 2f
val totalWidth = pathRightEdge + strokeHalf  // å³ä¾§è¡¥å¿
// å¦‚æœ Path æœ€å·¦ç«¯æ˜¯ x=0ï¼Œè¿˜éœ€è¦ leftPadding = strokeHalf
// æ›´å¥½çš„åšæ³•ï¼šPath æ„å»ºæ—¶æœ€å·¦ç«¯ä» strokeHalf å¼€å§‹ï¼Œè€Œé 0
```

**è§„åˆ™**ï¼šå‡¡æ˜¯ä½¿ç”¨ `Stroke` ç»˜åˆ¶çš„ Path/Lineï¼Œå…¶ `NodeLayout.width/height` å¿…é¡»åŒ…å« `strokeWidth / 2` çš„è¾¹è·è¡¥å¿ã€‚

#### (c) å¤§å‹è¿ç®—ç¬¦çš„è§†è§‰å®½åº¦ vs glyph å®½åº¦

ç§¯åˆ†å·ç­‰é€šè¿‡ç¼©æ”¾æˆ–ç‰¹æ®Šå­—ä½“ç»˜åˆ¶çš„è¿ç®—ç¬¦ï¼Œå…¶å®é™… glyph å®½åº¦å¯èƒ½è¿œå¤§äº"è§†è§‰æœ‰æ•ˆå®½åº¦"ã€‚

```kotlin
// âŒ é”™è¯¯ï¼šç”¨"è§†è§‰å®½åº¦"ä½œä¸º layout å®½åº¦ï¼Œglyph å®é™…æ›´å®½ï¼Œå³ä¾§è¢«è£åˆ‡
val width = opVisualWidth * 1.1f

// âœ… æ­£ç¡®ï¼šå– glyph å®é™…å®½åº¦ä¸è§†è§‰å®½åº¦çš„è¾ƒå¤§å€¼
val width = max(opGlyphLayout.width, opVisualWidth)
```

### 2.3 å‚ç›´æ–¹å‘æº¢å‡ºçš„æ¥æºä¸è¡¥å¿

#### (a) scale å˜æ¢åçš„å®é™…é«˜åº¦

ä½¿ç”¨ `withTransform { scale }` å‚ç›´æ‹‰ä¼¸å…ƒç´ æ—¶ï¼Œ`NodeLayout.height` å¿…é¡»åæ˜ æ‹‰ä¼¸åçš„é«˜åº¦ï¼š

```kotlin
// âŒ é”™è¯¯ï¼šheight ä½¿ç”¨æœªç¼©æ”¾çš„é«˜åº¦ï¼Œç¼©æ”¾åä¸Šä¸‹æº¢å‡º
val height = opLayout.height  // åŸå§‹é«˜åº¦
// draw ä¸­ withTransform { scale(scaleY = 2.0f) }  â†’ å®é™…å  2x é«˜åº¦

// âœ… æ­£ç¡®ï¼šheight ä¸ºç¼©æ”¾åçš„é«˜åº¦
val height = opLayout.height * verticalScale
```

#### (b) è£…é¥°ç¬¦å·çš„ç»˜åˆ¶åç§»

é‡éŸ³ç¬¦å·ï¼ˆhat/vecï¼‰åœ¨å±…ä¸­å¯¹é½æ—¶å¯èƒ½å›  `italicCorrection` åç§»å¯¼è‡´å³ä¾§æº¢å‡ºï¼š

```kotlin
// è£…é¥°å±…ä¸­ä½ç½® = contentCenter + italicCorrection
// width å¿…é¡»å®¹çº³åç§»åçš„è£…é¥°å®Œæ•´å®½åº¦
val accentRight = contentCenterX + italicCorrection + accentWidth / 2f
val totalWidth = max(contentWidth, accentRight)
```

#### (c) å®šç•Œç¬¦æ”¾å¤§åçš„ glyph æº¢å‡º

å­—ä½“æ”¾å¤§åï¼Œglyph çš„å¢¨æ°´è¾¹ç•Œå¯èƒ½è¶…å‡º `TextLayoutResult.size`ï¼ˆå°¤å…¶æ˜¯ descent æ–¹å‘ï¼‰ï¼š

```kotlin
// å¯¹æ”¾å¤§çš„å®šç•Œç¬¦ï¼Œæ·»åŠ ä¿å®ˆçš„å‚ç›´ä½™é‡
val verticalOverflow = if (scaleFactor > 1.5f) fontSizePx * 0.05f * scaleFactor else 0f
val totalHeight = measuredHeight + verticalOverflow * 2
```

### 2.4 å¤–å±‚ Canvas çš„å†…è¾¹è·æ¨¡å‹

NodeLayout å†…éƒ¨çš„ width/height å¿…é¡»ç²¾ç¡®åŒ…å«å¢¨æ°´è¾¹ç•Œï¼ˆ**å†…éƒ¨ç´§è´´**åŸåˆ™ï¼‰ã€‚åœ¨æ­¤åŸºç¡€ä¸Šï¼Œæœ€å¤–å±‚ Canvas æ·»åŠ ç»Ÿä¸€çš„å†…è¾¹è·ï¼Œä½¿å†…å®¹åŒºä¸çˆ¶å®¹å™¨ä¿æŒé—´è·ï¼š

```kotlin
@Composable
fun LatexDocument(layout: NodeLayout, context: RenderContext, ...) {
    val density = LocalDensity.current
    val fontSizePx = with(density) { context.fontSize.toPx() }

    // å¤–å±‚å†…è¾¹è·ï¼šå†…å®¹åŒºä¸ Canvas è¾¹ç¼˜çš„é—´è·
    val horizontalPadding = fontSizePx * 0.15f   // å·¦å³å„ 15% fontSize
    val verticalPadding = fontSizePx * 0.10f     // ä¸Šä¸‹å„ 10% fontSize

    val canvasWidth = layout.width + horizontalPadding * 2
    val canvasHeight = layout.height + verticalPadding * 2

    Canvas(modifier = Modifier.size(
        width = with(density) { canvasWidth.toDp() },
        height = with(density) { canvasHeight.toDp() }
    )) {
        // å†…å®¹ä» (horizontalPadding, verticalPadding) å¼€å§‹ç»˜åˆ¶
        layout.draw(this, horizontalPadding, verticalPadding)
    }
}
```

**è®¾è®¡ç†ç”±**ï¼š
- **æ°´å¹³å†…è¾¹è·**ï¼šè¡¥å¿æ–œä½“å­—å½¢å¯èƒ½çš„å¾®é‡æ®‹ä½™æº¢å‡º + è§†è§‰å‘¼å¸ç©ºé—´
- **å‚ç›´å†…è¾¹è·**ï¼šè¡¥å¿ descender å°¾ç«¯ã€è£…é¥°ç¬¦å·é¡¶éƒ¨ç­‰å¾®é‡æº¢å‡º + é¿å…å†…å®¹ç´§è´´ä¸Šä¸‹è¾¹ç¼˜
- å†…è¾¹è·å€¼ä¸ `fontSize` æˆæ­£æ¯”ï¼Œä¿è¯åœ¨ä¸åŒå­—å·ä¸‹è§†è§‰ä¸€è‡´

### 2.5 è¾¹ç•Œå®‰å…¨çš„åˆ†å±‚è´£ä»»

| å±‚çº§ | è´£ä»» | åšä»€ä¹ˆ |
|------|------|--------|
| **Measurerï¼ˆæ¯ä¸ªèŠ‚ç‚¹ï¼‰** | **ç²¾ç¡®å¢¨æ°´è¾¹ç•Œ** | width/height åŒ…å« Stroke åŠå®½ã€æ–œä½“æ‚¬ä¼¸ã€glyph å®é™…å¢¨æ°´èŒƒå›´ã€‚å†…éƒ¨ä¸ç•™ä½™é‡ã€‚ |
| **measureGroupï¼ˆè¡Œçº§ç»„åˆï¼‰** | **åŸºçº¿å¯¹é½æ±‡æ€»** | æ­£ç¡®è®¡ç®— maxAscent/maxDescentï¼Œä¸æ·»åŠ é¢å¤– paddingã€‚ |
| **LatexDocumentï¼ˆæœ€å¤–å±‚ï¼‰** | **ç»Ÿä¸€å†…è¾¹è·** | åœ¨ layout.width/height åŸºç¡€ä¸Šæ·»åŠ  horizontalPadding/verticalPaddingã€‚è¿™æ˜¯å”¯ä¸€æ·»åŠ "å‘¼å¸ç©ºé—´"çš„åœ°æ–¹ã€‚ |

**ç¦æ­¢**åœ¨ä¸­é—´å±‚ï¼ˆå•ä¸ª Measurer æˆ– measureGroupï¼‰æ·»åŠ "ä¿é™© padding"ã€‚å¦‚æœæŸä¸ª Measurer çš„å†…å®¹æº¢å‡ºï¼Œåº”ä¿®æ­£è¯¥ Measurer çš„å°ºå¯¸è®¡ç®—ï¼Œè€Œéåœ¨å¤–å±‚åŠ  padding æ©ç›–é—®é¢˜ã€‚

### 2.6 éªŒè¯æ–¹æ³•ï¼šè°ƒè¯•è¾¹æ¡†

å¼€å‘é˜¶æ®µå¯å¼€å¯è°ƒè¯•è¾¹æ¡†ï¼Œå¯è§†åŒ–æ¯ä¸ª NodeLayout çš„è¾¹ç•Œï¼š

```kotlin
// åœ¨ draw lambda çš„æœ€åï¼ˆæˆ–åŒ…è£…å±‚ï¼‰ç»˜åˆ¶åŠé€æ˜çº¢è‰²è¾¹æ¡†
fun DrawScope.debugBounds(x: Float, y: Float, width: Float, height: Float) {
    if (DEBUG_BOUNDS_ENABLED) {
        drawRect(
            color = Color.Red.copy(alpha = 0.3f),
            topLeft = Offset(x, y),
            size = Size(width, height),
            style = Stroke(1f)
        )
    }
}
```

å¦‚æœä»»ä½•å†…å®¹åƒç´ å‡ºç°åœ¨çº¢è‰²è¾¹æ¡†ä¹‹å¤–ï¼Œè¯´æ˜è¯¥èŠ‚ç‚¹çš„å°ºå¯¸è®¡ç®—æœ‰ bugï¼Œéœ€è¦ä¿®æ­£ã€‚

---

## 3. Path æ„å»ºç­–ç•¥ï¼šç›¸å¯¹åæ ‡ + translate

### 3.1 æ ¸å¿ƒçŸ›ç›¾ä¸è§£å†³æ–¹æ¡ˆ

Path å¯¹è±¡åŒ…å«çš„æ˜¯ç»å¯¹åæ ‡ç‚¹ï¼Œä½† draw æ—¶çš„ `(x, y)` åªåœ¨ç»˜åˆ¶æ—¶ç¡®å®šã€‚æœ‰ä¸‰ç§ç­–ç•¥ï¼š

| ç­–ç•¥ | åšæ³• | ä¼˜åŠ£ |
|------|------|------|
| **A: é¢„æ„å»º + translate** | Path ä»¥ `(0,0)` ä¸ºåŸç‚¹æ„å»ºï¼Œdraw æ—¶ç”¨ `translate(x, y)` åç§» | âœ… æ¨èï¼šPath åªåˆ›å»ºä¸€æ¬¡ï¼Œæ€§èƒ½æœ€ä¼˜ |
| B: draw æ—¶æ„å»º | æ¯æ¬¡ draw æ—¶åˆ›å»ºæ–° Path | âŒ æ¯å¸§åˆ†é…å¯¹è±¡ï¼ŒGC å‹åŠ› |
| C: Path å‚æ•°åŒ– | æŠ½è±¡ä¸ºå‡½æ•°ï¼Œä¼ å…¥ offset | âŒ è¿‡åº¦æŠ½è±¡ï¼Œå¯è¯»æ€§å·® |

### 3.2 æ ‡å‡†å†™æ³•

```kotlin
// Measure é˜¶æ®µï¼šä»¥ (0,0) ä¸ºåŸç‚¹æ„å»º Path
val sqrtPath = Path().apply {
    moveTo(0f, hookHeight)
    lineTo(hookWidth, totalHeight)       // V å½¢åº•éƒ¨
    lineTo(hookWidth + checkWidth, 0f)   // V å½¢é¡¶éƒ¨
    lineTo(totalWidth, 0f)               // æ°´å¹³é¡¶çº¿ç»ˆç‚¹
}

// Draw é˜¶æ®µï¼štranslate åˆ°å®é™…ä½ç½®åç»˜åˆ¶
draw = { x, y ->
    withTransform({ translate(left = x, top = y) }) {
        drawPath(sqrtPath, color = color, style = Stroke(strokeWidth))
    }
    contentLayout.draw(this, x + contentOffsetX, y + contentOffsetY)
}
```

### 3.3 Path å¤ç”¨ä¸å…±äº«

åŒç±»å‹ä½†ä¸åŒå°ºå¯¸çš„ Path **ä¸è¦**è¯•å›¾å¤ç”¨ï¼ˆå¦‚ä¸åŒå¤§å°çš„æ ¹å·ï¼‰ï¼Œæ¯ä¸ª NodeLayout å®ä¾‹æŒæœ‰è‡ªå·±çš„ Path å®ä¾‹ã€‚ä½†ç›¸åŒçš„ Path æ„å»ºé€»è¾‘åº”æŠ½å–ä¸ºå·¥å‚å‡½æ•°ï¼š

```kotlin
object PathFactory {
    fun createSqrtPath(hookWidth: Float, checkWidth: Float, totalWidth: Float, totalHeight: Float): Path { ... }
    fun createBracePath(width: Float, height: Float, isOver: Boolean): Path { ... }
    fun createArrowPath(width: Float, headSize: Float, direction: Direction): Path { ... }
}
```

---

## 4. æ–‡æœ¬æ¸²æŸ“ï¼šTextLayoutResult é¢„è®¡ç®—

### 4.1 æ ‡å‡†æµç¨‹

```kotlin
// Measure é˜¶æ®µ
val textLayoutResult = textMeasurer.measure(
    text = AnnotatedString(content),
    style = resolvedTextStyle   // å­—ä½“ã€å¤§å°ã€é¢œè‰²ç­‰å·²åœ¨æ­¤ç¡®å®š
)
val width = textLayoutResult.size.width.toFloat()
val height = textLayoutResult.size.height.toFloat()
val baseline = textLayoutResult.firstBaseline

// draw lambda ä¸­ â€” åªä¼ å…¥é¢„è®¡ç®—å¥½çš„ TextLayoutResult
draw = { x, y ->
    drawText(textLayoutResult, topLeft = Offset(x, y))
}
```

### 4.2 TextStyle ç¼“å­˜ç­–ç•¥

`TextStyle` åˆ›å»ºè™½ç„¶è½»é‡ä½†åœ¨é€’å½’æµ‹é‡æ•°åƒä¸ªèŠ‚ç‚¹æ—¶ç´¯ç§¯æ˜æ˜¾ã€‚åº”åœ¨ `RenderContext` ä¸­ç¼“å­˜å¸¸ç”¨æ ·å¼ï¼š

```kotlin
class RenderContext(
    val fontSize: TextUnit,
    val textColor: Color,
    val fontFamily: FontFamily,
    val fontWeight: FontWeight,
    val fontStyle: FontStyle,
    // ç¼“å­˜å¸¸ç”¨æ ·å¼å˜ä½“ï¼ˆlazy åˆå§‹åŒ–ï¼Œé¿å…æœªä½¿ç”¨æ—¶çš„å¼€é”€ï¼‰
    // ...
) {
    // å¯¹å¤–æä¾›çš„æ ·å¼è·å–æ–¹æ³•ï¼Œå†…éƒ¨å¯åšç¼“å­˜
    fun textStyle(): TextStyle = TextStyle(
        fontSize = fontSize,
        color = textColor,
        fontFamily = fontFamily,
        fontWeight = fontWeight,
        fontStyle = fontStyle,
    )
}
```

---

## 5. è·¨å¹³å°ä¸€è‡´æ€§

### 5.1 å­—ä½“ç­–ç•¥ï¼šå†…åµŒå­—ä½“ä¼˜å…ˆï¼Œå›é€€é›†ä¸­ç®¡ç†

**æ ¸å¿ƒåŸåˆ™**ï¼šè·¨å¹³å°ä¸€è‡´æ€§çš„æœ€å¤§æ•Œäººæ˜¯å­—ä½“å·®å¼‚ã€‚å¿…é¡»å†…åµŒæ•°å­¦å­—ä½“ï¼ˆå¦‚ Computer Modern ç³»åˆ—ï¼‰ï¼Œä½¿æ‰€æœ‰å¹³å°ä½¿ç”¨åŒä¸€å¥—å­—å½¢ã€‚

**å›é€€ç­–ç•¥é›†ä¸­ç®¡ç†**ï¼š

```kotlin
/**
 * é›†ä¸­ç®¡ç†å­—ä½“å›é€€ç­–ç•¥ã€‚
 * æ‰€æœ‰å­—ä½“é€‰æ‹©é€»è¾‘å½’å£æ­¤å¤„ï¼ŒMeasurer ä¸­ç¦æ­¢ç›´æ¥åˆ¤æ–­å¹³å°é€‰æ‹©å­—ä½“ã€‚
 */
object FontResolver {
    /**
     * å·²çŸ¥åœ¨ç‰¹å®šå¹³å°æœ‰æ¸²æŸ“ç¼ºé™·çš„å­—å½¢æ˜ å°„ã€‚
     * key = å­—å½¢å­—ç¬¦ä¸², value = éœ€è¦å›é€€çš„å¹³å°é›†åˆã€‚
     * ç»´æŠ¤è€…åº”åœ¨æ­¤è¡¨ä¸­è®°å½•æ¯ä¸€ä¸ªå·²çŸ¥çš„å¹³å°å­—ä½“ç¼ºé™·ã€‚
     */
    private val knownDefects: Map<String, Set<PlatformType>> = mapOf(
        "(" to setOf(PlatformType.JVM, PlatformType.JS, PlatformType.WASM),
        ")" to setOf(PlatformType.JVM, PlatformType.JS, PlatformType.WASM),
        "[" to setOf(PlatformType.JVM, PlatformType.JS, PlatformType.WASM),
        "]" to setOf(PlatformType.JVM, PlatformType.JS, PlatformType.WASM),
    )

    fun resolve(
        glyph: String,
        category: FontCategory,
        context: RenderContext,
        platform: PlatformType
    ): FontFamily {
        // 1. æ£€æŸ¥å·²çŸ¥ç¼ºé™·
        if (knownDefects[glyph]?.contains(platform) == true) {
            return getFallbackFont(category, platform)
        }
        // 2. ä½¿ç”¨å†…åµŒå­—ä½“
        return context.fontFamilies?.getFont(category)
            ?: getFallbackFont(category, platform)
    }

    private fun getFallbackFont(category: FontCategory, platform: PlatformType): FontFamily {
        return when {
            platform.isMobile -> FontFamily.Serif
            else -> FontFamily.SansSerif
        }
    }
}
```

**ä¸ºä»€ä¹ˆä¸ç”¨ expect/actual**ï¼šå­—ä½“å›é€€éœ€è¦æ ¹æ® **å­—å½¢å†…å®¹** + **å­—ä½“ç±»åˆ«** + **å¹³å°** ä¸‰ä¸ªç»´åº¦è”åˆå†³ç­–ã€‚`expect/actual` åªèƒ½æŒ‰å¹³å°åˆ†æ–‡ä»¶ï¼Œæ— æ³•è¡¨è¾¾"æŸä¸ªå­—å½¢åœ¨æŸä¸ªå¹³å°çš„æŸä¸ªå­—ä½“ä¸‹æœ‰ç¼ºé™·"è¿™ç§ç»†ç²’åº¦é€»è¾‘ã€‚é›†ä¸­ç®¡ç†çš„æ˜ å°„è¡¨å¯ç»´æŠ¤æ€§æ›´å¼ºï¼Œæ–°å¢ç¼ºé™·åªéœ€åŠ ä¸€è¡Œï¼Œæ— éœ€ä¿®æ”¹ 5 ä¸ªå¹³å°æ–‡ä»¶ã€‚

### 5.2 åæ ‡å•ä½

- å†…éƒ¨è®¡ç®—ç»Ÿä¸€ä½¿ç”¨ **px**
- ç”¨æˆ·é¢å‘çš„é…ç½®ä½¿ç”¨ `TextUnit`ï¼ˆspï¼‰å’Œ `Dp`
- è½¬æ¢é€šè¿‡ `Density` è¿›è¡Œï¼Œç¦æ­¢ç¡¬ç¼–ç å¯†åº¦å› å­
- `Density` åœ¨é¡¶å±‚ Composable è·å–åæ³¨å…¥åˆ° `RenderContext`ï¼Œé€’å½’è¿‡ç¨‹ä¸­ä¼ é€’åŒä¸€å®ä¾‹

### 5.3 é¢œè‰²ç®¡ç†

```kotlin
// âœ… æ‰€æœ‰é¢œè‰²ä» RenderContext è·å–
context.textColor       // ä¸»æ–‡æœ¬é¢œè‰²
context.errorColor      // é”™è¯¯å›é€€é¢œè‰²
context.lineColor       // åˆ†æ•°çº¿ã€æ ¹å·çº¿ç­‰ç»“æ„çº¿é¢œè‰²ï¼ˆé€šå¸¸ = textColorï¼‰

// âŒ ç¦æ­¢
Color.Black / Color.Red / Color(0xFF...)  // ç¡¬ç¼–ç é¢œè‰²æ— æ³•é€‚åº”æ·±è‰²æ¨¡å¼
```

é¢œè‰²åº”åœ¨æœ€å¤–å±‚ Composable æ ¹æ® `isSystemInDarkTheme()` è§£æåæ³¨å…¥ `RenderContext`ï¼Œå†…éƒ¨ç»˜åˆ¶é€»è¾‘ä¸æ„ŸçŸ¥ä¸»é¢˜ã€‚

---

## 6. åŸºçº¿å¯¹é½ç³»ç»Ÿ

### 6.1 æ°´å¹³æ’åˆ—çš„åŸºçº¿å¯¹é½ï¼ˆæ ¸å¿ƒå…¬å¼ï¼‰

å°†å¤šä¸ªå…ƒç´ æ°´å¹³æ’æˆä¸€è¡Œæ—¶ï¼š

```
// ç¬¬ä¸€éï¼šæ‰¾åˆ°ç»Ÿä¸€åŸºçº¿
maxAscent  = max(child_i.baseline)                    // æœ€å¤§ä¸Šå‡
maxDescent = max(child_i.height - child_i.baseline)   // æœ€å¤§ä¸‹é™
groupHeight = maxAscent + maxDescent
groupBaseline = maxAscent

// ç¬¬äºŒéï¼šæ¯ä¸ªå­å…ƒç´ çš„ y åç§»ï¼ˆåŸºçº¿å¯¹é½ï¼‰
childY(i) = groupY + (maxAscent - child_i.baseline)

// x æ–¹å‘é€ä¸ªæ’åˆ—
childX(i) = childX(i-1) + child_(i-1).width
```

**ä¸¥ç¦ä½¿ç”¨é¡¶éƒ¨å¯¹é½æˆ–ä¸­å¿ƒå¯¹é½æ’åˆ—è¡Œå†…å…ƒç´ **ã€‚å”¯ä¸€çš„ä¾‹å¤–æ˜¯ç‹¬ç«‹çš„å—çº§ç»“æ„ï¼ˆå¦‚å¤šè¡Œå…¬å¼çš„è¡Œé—´æ’åˆ—å¯ä½¿ç”¨ä¸­å¿ƒå¯¹é½ï¼‰ã€‚

### 6.2 æ•°å­¦è½´ (Math Axis)

æ•°å­¦è½´æ˜¯åˆ†æ•°çº¿ã€åŠ å‡å·ç­‰å…ƒç´ çš„å‚ç›´å¯¹ç§°ä¸­å¿ƒï¼Œé€šå¸¸ä½äºåŸºçº¿ä¸Šæ–¹çº¦ 0.5 Ã— x-height çš„ä½ç½®ã€‚

**è®¡ç®—æ–¹æ³•**ï¼šæµ‹é‡å­—ç¬¦ "âˆ’"ï¼ˆU+2212 MINUS SIGNï¼‰æˆ– "+" çš„å‚ç›´ä¸­å¿ƒä½ç½®ç›¸å¯¹äºåŸºçº¿çš„åç§»ï¼š

```kotlin
fun computeAxisHeight(textMeasurer: TextMeasurer, style: TextStyle): Float {
    val result = textMeasurer.measure(AnnotatedString("\u2212"), style)
    val baseline = result.firstBaseline
    val charMidY = result.size.height / 2f
    return baseline - charMidY
}
```

`axisHeight` çš„ç”¨é€”ï¼š
- **åˆ†æ•°çº¿** y åæ ‡ = elementY + baseline - axisHeight
- **å¤§å‹è¿ç®—ç¬¦**çš„å‚ç›´å±…ä¸­ç‚¹ = baseline - axisHeight
- **è‡ªåŠ¨ä¼¸ç¼©å®šç•Œç¬¦**çš„å‚ç›´å±…ä¸­ç‚¹ = å†…å®¹ baseline - axisHeight

**ç¼“å­˜**ï¼š`axisHeight` åªå–å†³äºå­—ä½“å’Œå­—å·ï¼Œåº”åœ¨ `RenderContext` ä¸­ç¼“å­˜ï¼Œé¿å…æ¯ä¸ªèŠ‚ç‚¹é‡å¤æµ‹é‡ã€‚

### 6.3 ä¸Šä¸‹æ ‡å®šä½

```
ä¸Šæ ‡é¡¶éƒ¨ä½ç½® = base.baseline - base.baseline * SUPERSCRIPT_SHIFT - sup.height
ä¸‹æ ‡é¡¶éƒ¨ä½ç½® = base.baseline + base.baseline * SUBSCRIPT_SHIFT - sub.baseline

å½“ä¸Šä¸‹æ ‡åŒæ—¶å­˜åœ¨æ—¶ï¼Œç¡®ä¿ä¸¤è€…ä¸é‡å ï¼š
  å¦‚æœ supBottom + minGap > subTopï¼Œåˆ™å‡åŒ€æ¨å¼€
```

---

## 7. æ•°å­¦æ’ç‰ˆé—´è·è§„èŒƒ

### 7.1 é—´è·ç±»å‹ï¼ˆå‚è€ƒ TeX æ ‡å‡†ï¼‰

LaTeX é—´è·çš„åº•å±‚å•ä½æ˜¯ **mu**ï¼ˆmath unitï¼‰ï¼Œ1 em = 18 muã€‚é—´è·åº”å®šä¹‰ä¸º fontSize çš„æ¯”ä¾‹ç³»æ•°ï¼š

```kotlin
object MathSpacing {
    // åŸºç¡€é—´è·ï¼ˆfontSize çš„æ¯”ä¾‹ç³»æ•°ï¼‰
    const val THIN   = 3f / 18f    // \, = 3mu  â‰ˆ 0.167em
    const val MEDIUM = 4f / 18f    // \: = 4mu  â‰ˆ 0.222em  (ä»… display/text style)
    const val THICK  = 5f / 18f    // \; = 5mu  â‰ˆ 0.278em  (ä»… display/text style)
    const val QUAD   = 1f          // \quad = 18mu = 1em
    const val NEGATIVE_THIN = -3f / 18f  // \! = -3mu

    /**
     * æ ¹æ®å·¦å³åŸå­ç±»å‹ç¡®å®šé—´è·ã€‚
     * å‚è€ƒ TeXbook Chapter 18 çš„é—´è·è§„åˆ™è¡¨ã€‚
     */
    fun spaceBetween(left: AtomType, right: AtomType, style: MathStyle): Float {
        return SPACING_TABLE[left]?.get(right)?.let { rule ->
            when (rule) {
                SpaceRule.NONE -> 0f
                SpaceRule.THIN -> THIN
                SpaceRule.MEDIUM -> if (style.isScript) 0f else MEDIUM
                SpaceRule.THICK -> if (style.isScript) 0f else THICK
            }
        } ?: 0f
    }
}
```

### 7.2 åŸå­ç±»å‹é—´è·è¡¨ï¼ˆTeX æ ‡å‡†ç®€åŒ–ç‰ˆï¼‰

| å·¦ \ å³ | Ord | Op | Bin | Rel | Open | Close | Punct |
|---------|-----|----|-----|-----|------|-------|-------|
| **Ord**   | 0 | thin | med | thick | 0 | 0 | 0 |
| **Op**    | thin | thin | - | thick | 0 | 0 | 0 |
| **Bin**   | med | med | - | - | med | - | - |
| **Rel**   | thick | thick | - | 0 | thick | 0 | 0 |
| **Open**  | 0 | 0 | - | 0 | 0 | 0 | 0 |
| **Close** | 0 | thin | med | thick | 0 | 0 | 0 |
| **Punct** | thin | thin | - | thin | thin | thin | thin |

> `-` è¡¨ç¤ºè¯¥ç»„åˆä¸åº”å‡ºç°ï¼›`med` å’Œ `thick` åœ¨ script/scriptscript æ ·å¼ä¸­é™ä¸º 0ã€‚

### 7.3 æ•°å­¦æ ·å¼ä¸ç¼©æ”¾

TeX å®šä¹‰äº† 4 ç§æ•°å­¦æ ·å¼ï¼Œå½±å“å­—å·å’Œé—´è·ï¼š

```kotlin
enum class MathStyle(val scriptLevel: Int) {
    DISPLAY(0),        // ç‹¬ç«‹è¡Œå…¬å¼ â€” å…¨å°ºå¯¸
    TEXT(0),           // è¡Œå†…å…¬å¼ â€” å…¨å°ºå¯¸
    SCRIPT(1),         // ä¸Šä¸‹æ ‡ â€” ç¼©å°
    SCRIPT_SCRIPT(2);  // ä¸Šä¸‹æ ‡çš„ä¸Šä¸‹æ ‡ â€” æ›´å°

    val isScript get() = scriptLevel > 0

    fun scaleFactor(): Float = when (this) {
        DISPLAY, TEXT -> 1.0f
        SCRIPT -> 0.7f
        SCRIPT_SCRIPT -> 0.5f
    }
}
```

**è§„åˆ™**ï¼š
- ä¸Šä¸‹æ ‡å†…å®¹ä½¿ç”¨ `SCRIPT` æ ·å¼ï¼ˆ0.7xï¼‰
- ä¸Šä¸‹æ ‡çš„ä¸Šä¸‹æ ‡ä½¿ç”¨ `SCRIPT_SCRIPT` æ ·å¼ï¼ˆ0.5xï¼‰
- `SCRIPT_SCRIPT` ä¸å†ç»§ç»­ç¼©å°ï¼ˆæœ€å°é˜ˆå€¼ï¼‰
- åˆ†æ•°çº¿ä¸Šä¸‹åœ¨ `DISPLAY` ä¸‹ä½¿ç”¨ `TEXT`ï¼Œåœ¨ `TEXT` ä¸‹ä½¿ç”¨ `SCRIPT`

---

## 8. ç¼©æ”¾ä¸å˜æ¢

### 8.1 ä½•æ—¶ä½¿ç”¨ scale vs é‡æ–°æµ‹é‡

| åœºæ™¯ | æ–¹æ¡ˆ | åŸå›  |
|------|------|------|
| ä¸Šä¸‹æ ‡ç¼©å° | **é‡æ–°æµ‹é‡**ï¼ˆç”¨æ›´å°çš„ fontSizeï¼‰ | æ–‡æœ¬æ¸…æ™°åº¦ï¼Œé¿å…æ¨¡ç³Š |
| å¤§å‹è¿ç®—ç¬¦æ”¾å¤§ | **é‡æ–°æµ‹é‡**ï¼ˆæ”¾å¤§ fontSizeï¼‰+ å¯é€‰å‚ç›´ scale | å­—ä½“å¼•æ“ä»¥ç›®æ ‡å­—å·å…‰æ …åŒ–ï¼Œè´¨é‡æœ€ä¼˜ |
| å®šç•Œç¬¦ä¼¸ç¼© | **é‡æ–°æµ‹é‡**ï¼ˆæ”¾å¤§ fontSize + FontWeight è¡¥å¿ï¼‰ | ç»Ÿä¸€æ–¹æ¡ˆï¼Œè¯¦è§ç¬¬ 9.3 èŠ‚ |

### 8.2 scale å˜æ¢çš„ç¬”ç”»è¡¥å¿

å½“ä½¿ç”¨ `scale` æ”¾å¤§æ–‡æœ¬æ—¶ï¼Œç¬”ç”»ç²—ç»†ä¼šç­‰æ¯”å˜ç²—ï¼Œè§†è§‰ä¸Šä¸è‡ªç„¶ã€‚å¿…é¡»é€šè¿‡é™ä½ `FontWeight` è¡¥å¿ï¼š

```kotlin
fun compensatedFontWeight(baseWeight: Int, scaleFactor: Float): FontWeight {
    // scaleFactor = 1.0 â†’ weight ä¸å˜
    // scaleFactor = 2.0 â†’ weight é™è‡³çº¦ 100
    // çº¿æ€§æ’å€¼ï¼Œä¸”é™åˆ¶åœ¨ [100, baseWeight] èŒƒå›´å†…
    val compensated = baseWeight - ((scaleFactor - 1.0f) * (baseWeight - 100) / 1.0f).toInt()
    return FontWeight(compensated.coerceIn(100, baseWeight))
}
```

å¯¹äº `Stroke` ç»˜åˆ¶çš„çº¿æ¡ï¼Œç›´æ¥åæ¯”è¡¥å¿ï¼š

```kotlin
fun compensatedStrokeWidth(baseStroke: Float, scaleFactor: Float): Float {
    return (baseStroke / scaleFactor).coerceAtLeast(0.5f)  // æœ€å° 0.5px é˜²æ­¢æ¶ˆå¤±
}
```

---

## 9. å­—ä½“ä½“ç³»ä¸å®šç•Œç¬¦ç»˜åˆ¶ç­–ç•¥

### 9.1 é¡¹ç›®å­—ä½“æ–‡ä»¶èƒ½åŠ›æ€»è§ˆ

é¡¹ç›®å†…åµŒ Computer Modern ç³»åˆ—å­—ä½“ï¼Œåˆ†ä¸‰å¤§ç±»ï¼š

#### æ–‡æœ¬å­—ä½“

| å­—ä½“æ–‡ä»¶ | æ§½ä½ | æä¾›çš„å­—å½¢ | ç”¨é€” |
|---------|------|-----------|------|
| `cmr10.ttf` | roman (Normal) | æ‹‰ä¸å­—æ¯ã€æ•°å­—ã€æ ‡ç‚¹ | `\text{}`ã€`\mathrm{}` |
| `cmti10.ttf` | roman (Italic) | æ‹‰ä¸æ–œä½“å­—æ¯ | æ–‡æœ¬æ–œä½“ |
| `cmss10.ttf` | sansSerif (Normal) | æ— è¡¬çº¿æ‹‰ä¸å­—æ¯ | `\mathsf{}` |
| `cmssi10.ttf` | sansSerif (Italic) | æ— è¡¬çº¿æ–œä½“ | `\mathsf{}` æ–œä½“ |
| `cmtt10.ttf` | monospace | ç­‰å®½å­—æ¯ | `\mathtt{}` |
| `cmbx10.ttf` | â€” (é¢„ç•™) | ç²—ä½“æ‹‰ä¸å­—æ¯ | `\mathbf{}` (å¾…å¯ç”¨) |
| `cmbxti10.ttf` | â€” (é¢„ç•™) | ç²—æ–œä½“ | `\boldsymbol{}` (å¾…å¯ç”¨) |

#### æ ¸å¿ƒæ•°å­¦å­—ä½“

| å­—ä½“æ–‡ä»¶ | æ§½ä½ | æä¾›çš„å­—å½¢ | å…³é”®èƒ½åŠ› |
|---------|------|-----------|---------|
| **`cmmi10.ttf`** | mathItalic | æ‹‰ä¸æ–œä½“å˜é‡ã€**å¸Œè…Šå­—æ¯**(Î±,Î²,Î³...) | æ•°å­¦å˜é‡çš„é»˜è®¤å­—ä½“ |
| **`cmsy10.ttf`** | symbol | è¿ç®—ç¬¦(+,Ã—,â‰¤)ã€**å°å‹å®šç•Œç¬¦** `( ) [ ] { } \|`ã€é€»è¾‘ç¬¦å·(âˆ€,âˆƒ) | è¡Œå†…å…¬å¼çš„æ‹¬å·ã€è¿ç®—ç¬¦ |
| **`cmex10.ttf`** | extension | **å¤§å‹è¿ç®—ç¬¦**(âˆ‘,âˆ«,âˆ,âˆ®)ã€**å¤§å‹å®šç•Œç¬¦**ã€æ ¹å·âˆš | Display æ¨¡å¼çš„å¤§ç¬¦å· |

#### ç‰¹æ®Šæ•°å­¦å­—ä½“

| å­—ä½“æ–‡ä»¶ | æ§½ä½ | æä¾›çš„å­—å½¢ |
|---------|------|-----------|
| `msbm10.ttf` | blackboardBold | é»‘æ¿ç²—ä½“ï¼šâ„, â„•, â„¤, â„‚ |
| `msam10.ttf` | (AMS symbols) | AMS æ•°å­¦å…³ç³»ç¬¦å· |
| `eufm10.ttf` | fraktur | å“¥ç‰¹ä½“ï¼šğ”¤, ğ”°ğ”² |
| `rsfs10.ttf` | script | æ‰‹å†™èŠ±ä½“ï¼šğ“›, â„‹ |

### 9.2 å„å¹³å°å·²çŸ¥å­—ä½“é—®é¢˜

| å­—å½¢ | Android | iOS | JVM Desktop | JS/WASM Web | æ ¹å›  |
|------|---------|-----|-------------|-------------|------|
| `( ) [ ]` (cmsy10) | âœ… æ­£å¸¸ | âœ… æ­£å¸¸ | âŒ å­—å½¢é”™è¯¯ | âŒ å­—å½¢é”™è¯¯ | cmsy10 ä½¿ç”¨ TeX å†…éƒ¨ç¼–ç ï¼Œæ¡Œé¢ç«¯å­—ä½“å¼•æ“è§£ç æ–¹å¼ä¸åŒ |
| `{ } \| â€–` (cmsy10) | âœ… æ­£å¸¸ | âœ… æ­£å¸¸ | âœ… æ­£å¸¸ | âœ… æ­£å¸¸ | â€” |
| `âˆ‘ âˆ« âˆ` (cmex10) | âœ… æ­£å¸¸ | âœ… æ­£å¸¸ | âœ… æ­£å¸¸ | âœ… æ­£å¸¸ | â€” |
| cmex10 descent | âš ï¸ descent æå¤§ | âš ï¸ descent æå¤§ | âš ï¸ descent æå¤§ | âš ï¸ descent æå¤§ | glyph åŒ…å«å¤§é‡ç©ºç™½ï¼Œå…¨å¹³å°ä¸€è‡´ï¼Œéœ€ç”¨ fontSize ä¼°ç®—è§†è§‰é«˜åº¦ |
| cmmi10 å¸Œè…Šå­—æ¯ | âœ… æ­£å¸¸ | âœ… æ­£å¸¸ | âœ… æ­£å¸¸ | âœ… æ­£å¸¸ | â€” |

**æ ¸å¿ƒç»“è®º**ï¼šè·¨å¹³å°å­—ä½“é—®é¢˜éå¸¸æœ‰é™ï¼Œä»… `( ) [ ]` åœ¨ cmsy10 + æ¡Œé¢ç«¯æœ‰å…¼å®¹æ€§é—®é¢˜ã€‚

### 9.3 å®šç•Œç¬¦æ¸²æŸ“ç­–ç•¥ï¼šå­—ä½“ç¼©æ”¾ä¼˜å…ˆï¼Œé¿å… Path æ‰‹ç»˜

> **æ ¸å¿ƒåŸåˆ™**ï¼šå°½å¯èƒ½ä½¿ç”¨å­—ä½“æ¸²æŸ“å®šç•Œç¬¦ï¼Œé¿å… Path æ‰‹åŠ¨ç»˜åˆ¶ã€‚å­—ä½“æ¸²æŸ“çš„ç¬”ç”»ç²—ç»†ã€è¡¬çº¿ç»†èŠ‚ã€æ›²çº¿è´¨é‡è¿œä¼˜äºæ‰‹ç»˜ Pathï¼Œä¸”è‡ªåŠ¨é€‚é… hinting å’Œå­åƒç´ æ¸²æŸ“ã€‚

#### ç»Ÿä¸€æ–¹æ¡ˆï¼šfontSize ç›´æ¥ç¼©æ”¾

æ‰€æœ‰å°ºå¯¸çš„å®šç•Œç¬¦å‡é‡‡ç”¨ **è°ƒæ•´ fontSize + åŠ¨æ€ FontWeight è¡¥å¿** çš„æ–¹æ¡ˆï¼š

```kotlin
fun measureDelimiterScaled(
    delimiter: String,
    context: RenderContext,
    textMeasurer: TextMeasurer,
    targetHeight: Float
): NodeLayout {
    // 1. åŸºç¡€æµ‹é‡ï¼šç”¨å½“å‰ fontSize æµ‹é‡é»˜è®¤é«˜åº¦
    val baseLayout = measureDelimiterText(delimiter, context, textMeasurer)
    val scale = targetHeight / baseLayout.height

    // 2. FontWeight è¡¥å¿ï¼šå­—å·æ”¾å¤§åç¬”ç”»å˜ç²—ï¼Œéœ€é™ä½ weight
    val compensatedWeight = compensatedFontWeight(400, scale)

    // 3. å­—ä½“é€‰æ‹©ï¼šæ ¹æ®å­—å½¢ + å¹³å°é€‰æ‹©æ­£ç¡®çš„å­—ä½“
    val fontFamily = FontResolver.resolve(delimiter, FontCategory.SYMBOL, context, platform)

    // 4. ç”¨æ”¾å¤§çš„ fontSize é‡æ–°æµ‹é‡
    val scaledContext = context.copy(
        fontSize = context.fontSize * scale,
        fontWeight = compensatedWeight,
        fontFamily = fontFamily
    )
    return measureDelimiterText(delimiter, scaledContext, textMeasurer)
}
```

**ä¸ºä»€ä¹ˆä¸ç”¨ Canvas scale å˜æ¢**ï¼š
- `withTransform { scale }` ä¼šç­‰æ¯”æ‹‰ä¼¸æ‰€æœ‰åƒç´ ï¼ˆåŒ…æ‹¬ç¬”ç”»å®½åº¦ï¼‰ï¼Œå¯¼è‡´æ°´å¹³æ–¹å‘ç¬”ç”»å¤±çœŸ
- ç›´æ¥æ”¾å¤§ `fontSize` è®©å­—ä½“å¼•æ“ä»¥ç›®æ ‡å­—å·é‡æ–°å…‰æ …åŒ–ï¼Œç¬”ç”»è´¨é‡ç”±å¼•æ“ä¿è¯

**ä¸ºä»€ä¹ˆä¸ç”¨ Path æ‰‹ç»˜**ï¼š
- æ‰‹ç»˜çš„è´å¡å°”æ›²çº¿æ— æ³•æ¨¡æ‹Ÿå­—ä½“çš„ hintingã€å­åƒç´ æ¸²æŸ“å’Œè¡¬çº¿ç»†èŠ‚
- æ‰‹ç»˜ Path åœ¨ä¸åŒ DPI ä¸‹çš„è§†è§‰ç²—ç»†ä¸ä¸€è‡´
- ç»´æŠ¤æˆæœ¬é«˜ï¼ˆæ¯ç§æ‹¬å·éƒ½è¦æ‰‹å†™å‡ åè¡Œ Path ä»£ç ï¼‰
- å­—ä½“æ–‡ä»¶å¤©ç„¶è·¨å¹³å°ä¸€è‡´ï¼ˆç›¸åŒå­—ä½“åœ¨æ‰€æœ‰å¹³å°äº§ç”Ÿç›¸åŒå­—å½¢ï¼‰

#### å¹³å°å­—ä½“å›é€€è§„åˆ™

å½“ cmsy10 çš„æŸäº›å­—å½¢åœ¨ç‰¹å®šå¹³å°æœ‰æ¸²æŸ“ç¼ºé™·æ—¶ï¼Œé€šè¿‡ `FontResolver` é›†ä¸­å›é€€ï¼ˆè§ç¬¬ 5.1 èŠ‚ï¼‰ï¼Œè€Œéé™çº§ä¸º Path æ‰‹ç»˜ï¼š

```
cmsy10 å­—å½¢æ¸²æŸ“å¤±è´¥ï¼Ÿ
  â†’ å›é€€åˆ°ç³»ç»Ÿå­—ä½“ï¼ˆSansSerif/Serifï¼‰æ¸²æŸ“åŒä¸€å­—ç¬¦
  â†’ ä»ç„¶æ˜¯å­—ä½“æ¸²æŸ“ï¼Œä»ç„¶äº«å—å­—ä½“å¼•æ“çš„æ¸²æŸ“è´¨é‡
  
ä¸è¦ï¼šcmsy10 å¤±è´¥ â†’ Path æ‰‹ç»˜ï¼ˆè´¨é‡ä¸‹é™ã€ç»´æŠ¤æˆæœ¬é«˜ï¼‰
```

#### cmex10 å¤§å‹å®šç•Œç¬¦çš„ä½¿ç”¨

cmex10 å­—ä½“åŒ…å«ä¸“é—¨ä¸º Display æ¨¡å¼è®¾è®¡çš„å¤§å‹å®šç•Œç¬¦å­—å½¢ã€‚å½“å®šç•Œç¬¦éœ€è¦è¶…è¿‡æ™®é€šæ–‡æœ¬è¡Œé«˜æ—¶ï¼š

```kotlin
// ä¼˜å…ˆå°è¯• cmex10 çš„å¤§å‹å­—å½¢
val extensionFont = context.fontFamilies?.extension  // cmex10
if (extensionFont != null && targetHeight > baseLineHeight * 1.5f) {
    // cmex10 çš„å¤§å‹å®šç•Œç¬¦å­—å½¢å¤©ç„¶æ›´å¤§ï¼Œéœ€è¦çš„ scale æ›´å°ï¼Œè´¨é‡æ›´å¥½
    return measureDelimiterScaled(delimiter, context.copy(fontFamily = extensionFont), ...)
}
// å›é€€ï¼šç”¨ cmsy10 æˆ–ç³»ç»Ÿå­—ä½“ + fontSize ç¼©æ”¾
return measureDelimiterScaled(delimiter, context, ...)
```

**cmex10 descent å¤„ç†æ³¨æ„**ï¼šcmex10 çš„ glyph åŒ…å«å¤§é‡ descent ç©ºç™½ï¼Œ`TextLayoutResult.size.height` è¿œå¤§äºè§†è§‰é«˜åº¦ã€‚å¿…é¡»ç”¨ä»¥ä¸‹æ–¹å¼ä¼°ç®—è§†è§‰é«˜åº¦ï¼š

```kotlin
val visualHeight = min(textLayoutResult.firstBaseline * 1.1f, textLayoutResult.size.height.toFloat())
```

#### çŸ©é˜µæ‹¬å·ç»Ÿä¸€

çŸ©é˜µç¯å¢ƒï¼ˆpmatrix, bmatrix ç­‰ï¼‰çš„æ‹¬å·ä¹Ÿåº”è¿ç§»åˆ°å­—ä½“ç¼©æ”¾æ–¹æ¡ˆï¼Œä¸ `\left...\right` å’Œ `\big` ç³»åˆ—å®šç•Œç¬¦ä½¿ç”¨åŒä¸€å¥—æ¸²æŸ“è·¯å¾„ï¼Œæ¶ˆé™¤ä¸¤å¥—æ–¹æ¡ˆå¹¶å­˜çš„é—®é¢˜ã€‚

### 9.4 Path ç»˜åˆ¶çš„é€‚ç”¨åœºæ™¯ï¼ˆä¸¥æ ¼é™å®šï¼‰

Path æ‰‹ç»˜**ä»…ç”¨äº**ä»¥ä¸‹ä¸å¯èƒ½é€šè¿‡å­—ä½“è¡¨è¾¾çš„å›¾å½¢ï¼š

| å›¾å½¢ | åŸå›  |
|------|------|
| æ ¹å· âˆš çš„ V å½¢é’© + æ°´å¹³é¡¶çº¿ | æ ¹å·éœ€è¦æ ¹æ®å†…å®¹å®½åº¦åŠ¨æ€å»¶ä¼¸é¡¶çº¿ï¼Œå­—ä½“å­—å½¢æ— æ³•åšåˆ° |
| åˆ†æ•°çº¿ | ç®€å•æ°´å¹³çº¿ï¼ŒdrawLine å³å¯ï¼Œæ— éœ€å­—ä½“ |
| `\overline` / `\underline` | ç®€å•æ°´å¹³çº¿ |
| `\overbrace` / `\underbrace` çš„æ›²çº¿ | éœ€æ ¹æ®å†…å®¹å®½åº¦åŠ¨æ€æ‹‰ä¼¸ï¼Œå­—ä½“å­—å½¢å®½åº¦å›ºå®š |
| `\widehat` / `\widetilde` | éœ€æ ¹æ®å†…å®¹å®½åº¦åŠ¨æ€æ‹‰ä¼¸ |
| å¯ä¼¸ç¼©ç®­å¤´ `\xrightarrow` | ç®­å¤´é•¿åº¦åŠ¨æ€ï¼Œå­—ä½“æ— æ³•è¡¨è¾¾ |
| `\cancel` æ–œçº¿ | ç®€å•æ–œçº¿ |

**åˆ¤æ–­æ ‡å‡†**ï¼šå¦‚æœå›¾å½¢çš„æŸä¸ªç»´åº¦ï¼ˆå®½åº¦æˆ–é«˜åº¦ï¼‰éœ€è¦æ ¹æ®å†…å®¹åŠ¨æ€ä¼¸ç¼©ï¼Œä¸”å­—ä½“å­—å½¢æ— æ³•è¡¨è¾¾è¿™ç§ä¼¸ç¼©æ€§ï¼Œæ‰ä½¿ç”¨ Pathã€‚å¦åˆ™ä¸€å¾‹ä½¿ç”¨å­—ä½“æ¸²æŸ“ã€‚

---

## 10. æ€§èƒ½è§„èŒƒ

### 10.1 Composable å±‚çº§

```kotlin
@Composable
fun Latex(latex: String, config: LatexConfig, ...) {
    // 1. è·å–å¹³å°å·¥å…·ï¼ˆTextMeasurer, Densityï¼‰
    val textMeasurer = rememberTextMeasurer()
    val density = LocalDensity.current

    // 2. å¼‚æ­¥è§£æ
    var document by remember { mutableStateOf<Document?>(null) }
    LaunchedEffect(latex) {
        document = withContext(Dispatchers.Default) { parser.parse(latex) }
    }

    // 3. åŒæ­¥æµ‹é‡ï¼ˆä¾èµ– textMeasurerï¼Œå¿…é¡»åœ¨ Composition ä¸­ï¼‰
    val layout = remember(document, config, density) {
        document?.let { measureGroup(it.children, context, textMeasurer, density) }
    }

    // 4. ç»˜åˆ¶
    layout?.let { lay ->
        Canvas(modifier = Modifier.size(
            width = with(density) { lay.width.toDp() },
            height = with(density) { lay.height.toDp() }
        )) {
            lay.draw(this, 0f, 0f)
        }
    }
}
```

**å…³é”®è®¾è®¡å†³ç­–**ï¼š
- **è§£æ**åœ¨ `Dispatchers.Default` ä¸Šå¼‚æ­¥æ‰§è¡Œï¼ˆCPU å¯†é›†ï¼‰
- **æµ‹é‡**åœ¨ Composition ä¸»çº¿ç¨‹åŒæ­¥æ‰§è¡Œï¼ˆå› ä¸º `TextMeasurer.measure()` éœ€è¦åœ¨ä¸»çº¿ç¨‹è°ƒç”¨ï¼Œä¸”éœ€è¦ font èµ„æºåŠ è½½å®Œæˆï¼‰
- **ç»˜åˆ¶**æ˜¯çº¯ç²¹çš„ Canvas å›è°ƒï¼Œåªæ‰§è¡Œé¢„è®¡ç®—å¥½çš„ç»˜åˆ¶æŒ‡ä»¤
- `remember` çš„ key æ˜¯ `(document, config, density)`ï¼Œç¡®ä¿è¾“å…¥ä¸å˜æ—¶ä¸é‡æ–°æµ‹é‡

### 10.2 Canvas å°ºå¯¸ä¸å†…è¾¹è·

Canvas å°ºå¯¸ = layout å°ºå¯¸ + å¤–å±‚å†…è¾¹è·ã€‚è¯¦è§ **ç¬¬ 2.4 èŠ‚**ã€‚

- å¿…é¡»ä½¿ç”¨ `Modifier.size(width, height)` æŒ‡å®šç²¾ç¡®å°ºå¯¸
- æ°´å¹³å’Œå‚ç›´æ–¹å‘å‡éœ€æ·»åŠ å†…è¾¹è·ï¼ˆåˆ†åˆ«ä¸º fontSize Ã— 0.15 å’Œ fontSize Ã— 0.10ï¼‰
- **ç¦æ­¢** `fillMaxSize()` / `fillMaxWidth()`ï¼ˆå¯¼è‡´ä¸å¿…è¦çš„å°ºå¯¸å˜åŒ–å’Œé‡ç»˜ï¼‰
- **ç¦æ­¢**ä»…åœ¨æ°´å¹³æ–¹å‘æ·»åŠ  padding è€Œå¿½ç•¥å‚ç›´æ–¹å‘

### 10.3 å¢é‡è§£æ

å¯¹äºæµå¼è¾“å…¥åœºæ™¯ï¼ˆå¦‚é€å­—è¾“å…¥ LaTeXï¼‰ï¼Œè§£æå™¨åº”æ”¯æŒå¢é‡è¿½åŠ ï¼š
- æ–°è¾“å…¥æ˜¯ä¸Šæ¬¡è¾“å…¥çš„å‰ç¼€æ‰©å±• â†’ åªè§£ææ–°å¢éƒ¨åˆ†
- å¦åˆ™ â†’ æ¸…ç©ºé‡æ–°è§£æ
- è§£æç»“æœé€šè¿‡ `mutableStateOf` é©±åŠ¨é‡ç»„

---

## 11. é”™è¯¯å¤„ç†ä¸å®¹é”™

### 11.1 ç©º/å¼‚å¸¸å¸ƒå±€

```kotlin
val EMPTY_LAYOUT = NodeLayout(
    width = 0f, height = 0f, baseline = 0f,
    draw = { _, _ -> }
)
```

ä»»ä½•æµ‹é‡å‡½æ•°åœ¨é‡åˆ°å¼‚å¸¸è¾“å…¥æ—¶ï¼Œè¿”å› `EMPTY_LAYOUT` è€ŒéæŠ›å‡ºå¼‚å¸¸æˆ–è¿”å› nullã€‚

### 11.2 æ•°å€¼å®‰å…¨

æ‰€æœ‰ä»æµ‹é‡ç»“æœå¾—åˆ°çš„æµ®ç‚¹æ•°ï¼Œåœ¨å‚ä¸å¸ƒå±€è®¡ç®—å‰å¿…é¡»é€šè¿‡å®‰å…¨æ£€æŸ¥ï¼š

```kotlin
fun Float.sanitized(fallback: Float = 0f): Float = when {
    isNaN() || isInfinite() -> fallback
    this < 0f -> 0f
    else -> this
}
```

### 11.3 æœªè¯†åˆ«å‘½ä»¤

ä»¥**åŸå§‹æ–‡æœ¬ + é”™è¯¯é¢œè‰²**æ¸²æŸ“ï¼Œç¡®ä¿ç”¨æˆ·èƒ½çœ‹åˆ°é—®é¢˜æ‰€åœ¨è€Œéç©ºç™½ï¼š

```kotlin
// ä½¿ç”¨ context.errorColorï¼ˆè€Œéç¡¬ç¼–ç  Color.Redï¼‰
val errorStyle = context.textStyle().copy(color = context.errorColor)
```

---

## 12. ä»£ç ç»„ç»‡

### 12.1 Measurer èŒè´£åˆ’åˆ†

æ¯ä¸ª Measurer è´Ÿè´£ä¸€ç±» AST èŠ‚ç‚¹çš„æµ‹é‡ + ç»˜åˆ¶æŒ‡ä»¤ç”Ÿæˆï¼š

| Measurer | è´Ÿè´£çš„ LaTeX ç»“æ„ |
|----------|------------------|
| TextContentMeasurer | æ™®é€šæ–‡æœ¬ã€ç¬¦å·ã€è¿ç®—ç¬¦ã€ç©ºç™½ |
| MathMeasurer | åˆ†æ•°ã€æ ¹å·ã€ä¸Šä¸‹æ ‡ã€å¤§å‹è¿ç®—ç¬¦ |
| MatrixMeasurer | çŸ©é˜µã€æ•°ç»„ã€casesã€aligned |
| DelimiterMeasurer | \left \right è‡ªåŠ¨ä¼¸ç¼©ã€\big \Big ç­‰æ‰‹åŠ¨å¤§å° |
| AccentMeasurer | \hat \vec \overline \underbrace ç­‰è£…é¥° |
| StackMeasurer | \overset \underset \stackrel |
| ExtensibleArrowMeasurer | \xrightarrow \xleftarrow |
| SpecialEffectMeasurer | \boxed \phantom \cancel |

### 12.2 Measurer æ¥å£

```kotlin
interface NodeMeasurer<T : LatexNode> {
    fun measure(
        node: T,
        context: RenderContext,
        measurer: TextMeasurer,
        density: Density,
        measureNode: (LatexNode, RenderContext) -> NodeLayout,    // é€’å½’æµ‹é‡å•èŠ‚ç‚¹
        measureGroup: (List<LatexNode>, RenderContext) -> NodeLayout  // é€’å½’æµ‹é‡èŠ‚ç‚¹åˆ—è¡¨
    ): NodeLayout
}
```

`measureNode` å’Œ `measureGroup` ä½œä¸ºå‡½æ•°å‚æ•°æ³¨å…¥ï¼Œå®ç° Measurer é—´çš„è§£è€¦ã€‚æ¯ä¸ª Measurer ä¸ç›´æ¥å¼•ç”¨å…¶ä»– Measurerã€‚

### 12.3 å‘½åçº¦å®š

```kotlin
// æµ‹é‡å…¥å£
fun measure[ç»“æ„å](node, context, ...): NodeLayout

// Path å·¥å‚
fun create[å›¾å½¢å]Path(å‚æ•°...): Path

// é—´è·/å°ºå¯¸è®¡ç®—
fun compute[å±æ€§å](context): Float

// æ ·å¼å˜ä½“
fun RenderContext.with[å˜åŒ–](): RenderContext   // å¦‚ withScriptStyle(), withBoldWeight()
```

---

## 13. å¼€å‘æ£€æŸ¥æ¸…å•

æ¯æ¬¡æ–°å¢æˆ–ä¿®æ”¹ç»˜åˆ¶åŠŸèƒ½ï¼Œé€é¡¹æ£€æŸ¥ï¼š

- [ ] **è¾¹ç•Œå®‰å…¨**ï¼šNodeLayout.width/height åŒ…å«æ‰€æœ‰å¢¨æ°´ï¼ˆStroke åŠå®½ã€æ–œä½“æ‚¬ä¼¸ã€glyph å®é™…èŒƒå›´ï¼‰
- [ ] **è¾¹ç•Œå®‰å…¨**ï¼šæ–œä½“è¡¥å¿ä½¿ç”¨ px å•ä½ï¼ˆ`density.toPx()`ï¼‰ï¼Œè€Œé sp çš„ `.value`
- [ ] **è¾¹ç•Œå®‰å…¨**ï¼šscale å˜æ¢åçš„ height åæ˜ ç¼©æ”¾åçš„å®é™…é«˜åº¦
- [ ] **è¾¹ç•Œå®‰å…¨**ï¼šå¤–å±‚ Canvas æ°´å¹³å’Œå‚ç›´æ–¹å‘å‡æœ‰å†…è¾¹è·
- [ ] draw lambda ä¸­æ— æµ‹é‡è°ƒç”¨ã€æ— å¯¹è±¡åˆ†é…ã€æ— å¹³å°åˆ†æ”¯
- [ ] Path ä»¥ (0,0) ä¸ºåŸç‚¹æ„å»ºï¼Œdraw æ—¶é€šè¿‡ translate åç§»
- [ ] æ°´å¹³æ’åˆ—ä½¿ç”¨åŸºçº¿å¯¹é½ï¼ˆéé¡¶éƒ¨/ä¸­å¿ƒå¯¹é½ï¼‰
- [ ] æ•°å­¦ç»“æ„ä»¥æ•°å­¦è½´ä¸ºä¸­å¿ƒï¼ˆåˆ†æ•°çº¿ã€å¤§å‹è¿ç®—ç¬¦ï¼‰
- [ ] é—´è·é€šè¿‡ `MathSpacing.spaceBetween()` è®¡ç®—ï¼Œæ— é­”æ³•æ•°å­—
- [ ] é¢œè‰²æ¥è‡ª `RenderContext`ï¼Œæ— ç¡¬ç¼–ç  `Color.Xxx`
- [ ] å­—ä½“é€šè¿‡ `FontResolver.resolve()` è·å–ï¼Œæ— åˆ†æ•£çš„å¹³å°åˆ¤æ–­
- [ ] scale å˜æ¢æœ‰ç¬”ç”»è¡¥å¿ï¼ˆFontWeight æˆ– strokeWidthï¼‰
- [ ] å®šç•Œç¬¦ä½¿ç”¨å­—ä½“ fontSize ç¼©æ”¾æ–¹æ¡ˆï¼Œé Path æ‰‹ç»˜ï¼ˆä»…æ ¹å·é’©/åˆ†æ•°çº¿/åŠ¨æ€å®½åº¦è£…é¥°ç”¨ Pathï¼‰
- [ ] ä¸Šä¸‹æ ‡ä½¿ç”¨ `MathStyle` ç¼©æ”¾ï¼Œè€Œéç›´æ¥ä¿®æ”¹ fontSize
- [ ] ç©ºè¾“å…¥è¿”å› `EMPTY_LAYOUT`ï¼Œä¸æŠ›å¼‚å¸¸
- [ ] æµ®ç‚¹æ•°ç»è¿‡ `sanitized()` æ£€æŸ¥
- [ ] `remember` çš„ key æ˜¯è¾“å…¥æ•°æ®ï¼ˆAST + configï¼‰ï¼Œä¸æ˜¯ layout æœ¬èº«
- [ ] Canvas ä½¿ç”¨ç²¾ç¡® `Modifier.size()`
- [ ] åœ¨ Android / iOS / Desktop(JVM) ä¸‰ç«¯éªŒè¯æ¸²æŸ“ä¸€è‡´